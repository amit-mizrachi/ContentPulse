# ========================================================================
# REDIS CACHE - HELM VALUES
# ========================================================================
# Kubernetes-native Redis deployment for LLM Judge
# Deploy: helm install redis ./charts/redis -f releases/redis-values.yaml -n llm-judge
# ========================================================================

image:
  repository: redis
  tag: "7.1-alpine"
  pullPolicy: IfNotPresent

fullnameOverride: "redis"

service:
  type: ClusterIP
  port: 6379

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

persistence:
  enabled: true
  storageClassName: "gp3"
  accessMode: ReadWriteOnce
  size: 10Gi

# Redis configuration
config:
  maxmemory: "256mb"
  maxmemoryPolicy: "allkeys-lru"
  save: "900 1 300 10 60 10000"
  appendonly: "yes"
  appendfsync: "everysec"

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 999
  fsGroup: 999
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Node selection - deploy on application nodes
nodeSelector:
  role: application

# Anti-affinity to avoid single point of failure
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - redis
          topologyKey: kubernetes.io/hostname

# Health probes
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3
