# ========================================================================
# GATEWAY SERVICE - HELM VALUES
# ========================================================================
# Configuration values come from Terraform-managed ConfigMap (infra-config)
# Deploy: helm install gateway ./charts/llm-judge-service -f releases/gateway-values.yaml
# ========================================================================

service:
  name: gateway-service
  type: ClusterIP
  containerPort: 8000      # Must match PORT_GATEWAY in ConfigMap
  portKey: PORT_GATEWAY    # ConfigMap key for SERVICE_PORT

image:
  pullPolicy: Always

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: ""  # Set from Terraform output
  name: gateway-service

resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10

# AppConfig bootstrap IDs - set from Terraform outputs
appConfig:
  applicationId: ""
  environmentId: ""
  profileId: ""

ingress:
  enabled: true
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix

networkPolicy:
  enabled: true
  ingress:
    - ports:
        - port: 8000
          protocol: TCP
  egress:
    - ports:
        - port: 53
          protocol: UDP
    - ipBlock:
        cidr: 0.0.0.0/0
      ports:
        - port: 443
          protocol: TCP
    - podSelector:
        matchLabels:
          app: redis-service
      ports:
        - port: 8001
          protocol: TCP

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: DoNotSchedule
    labelSelector:
      matchLabels:
        app: gateway-service

nodeSelector:
  role: application
